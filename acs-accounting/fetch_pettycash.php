<?php        include 'connect.php';    function MonthThaiShort($strDate) {        $strYear = substr(date("Y",strtotime($strDate))+543,-2);        $strMonth= date("n",strtotime($strDate));        $strDay= date("j",strtotime($strDate));        $strHour= date("H",strtotime($strDate));        $strMinute= date("i",strtotime($strDate));        $strSeconds= date("s",strtotime($strDate));        $strMonthCut = Array("","ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค.");        $strMonthThai = $strMonthCut[$strMonth];        return "$strDay $strMonthThai $strYear";    }    $limit = '10';    $pageno = 1;    if($_POST['page'] > 1) {        $start = (($_POST['page'] - 1) * $limit);        $pageno = $_POST['page'];    } else {        $start = 0;    }    $str_sql = "SELECT * FROM pettycash_tb AS pcash                 INNER JOIN company_tb AS c ON pcash.pcash_compid = c.comp_id                 INNER JOIN payable_tb AS p ON pcash.pcash_payaid = p.paya_id                 INNER JOIN department_tb AS d ON pcash.pcash_depid = d.dep_id                 WHERE pcash_stsid = 0 AND pcash_compid = '". $_POST["queryComp"] ."' AND pcash_depid = '". $_POST['queryDep'] ."' ";    if($_POST['querySearch'] != '') {        if($_POST['query'] != '') {            $str_sql .= ' AND '. $_POST['querySearch'] .' LIKE "%'.str_replace(' ', '%', $_POST['query']).'%" ';        }    }    if($_POST['queryFil'] != '') {        if($_POST['queryFilVal'] != '') {            $str_sql .= ' ORDER BY '. $_POST["queryFil"] .' '. $_POST["queryFilVal"];        }    } else {        if($_POST['queryFilVal'] != '') {            $str_sql .= ' ORDER BY pcash_id ' . $_POST["queryFilVal"];        } else {            $str_sql .= ' ORDER BY pcash_id DESC ';        }    }    $filter_query = $str_sql . 'LIMIT '.$start.', '.$limit.'';    // echo $str_sql;    $obj_query = mysqli_query($obj_con, $str_sql);    $total_data = mysqli_num_rows($obj_query);    $obj_query = mysqli_query($obj_con, $filter_query);    $obj_row = mysqli_fetch_array($obj_query);    $total_filter_data = mysqli_num_rows($obj_query);    $output = '<table class="table mb-0">                    <thead class="thead-light">                        <tr>                            <th width="22%">เลขที่ใบจ่ายเงินสดย่อย</th>                            <th width="43%">รายละเอียด</th>                            <th class="text-center">จำนวนเงิน</th>                            <th width="8%" class="text-center">ฝ่าย</th>                            <th width="5%"></th>                        </tr>                    </thead>                    <tbody>';    if($total_data > 0) {        $i = 1;        $total = 0;        foreach($obj_query as $obj_row) {            $pcashid = $obj_row["pcash_id"];            $netamount = $obj_row["pcash_netamount1"] + $obj_row["pcash_netamount2"] + $obj_row["pcash_netamount3"] + $obj_row["pcash_netamount4"] + $obj_row["pcash_netamount5"];            $total = $total + $netamount;            $description = $obj_row["pcash_description1"] . " " . $obj_row["pcash_description2"] . " " . $obj_row["pcash_description3"] . " " . $obj_row["pcash_description4"] . " " . $obj_row["pcash_description5"];            $output .= '<tr id="tr'. $pcashid .'">                            <td class="d-none">                                '. $obj_row['pcash_id'] .'                                <input type="text" name="pcid" value="'. $obj_row['pcash_id'] .'">                            </td>                            <td>                                <div class="truncate-id">                                    '. $obj_row['pcash_no'] .'                                </div>                            </td>                            <td>                                <div class="truncate">                                    <b>บริษัท : </b> '. $obj_row['paya_name'] .'<br>                                    <b>รายการ : </b> '. $description .'                                </div>                            </td>                            <td>                                <input type="text" class="form-control text-right" value="'. number_format($netamount,2) .'" readonly>                                <input type="text" class="form-control text-right d-none numInvNet" value="'. $netamount .'" readonly>                            </td>                            <td class="text-center text-nowrap">                                '. $obj_row['dep_name'] .'                            </td>                            <td>                                <div class="btn-group btn-group-toggle">                                    <a href="pettycash_edit.php?cid='. $obj_row['pcash_compid'] .'&dep='. $obj_row['pcash_depid'] .'&pcid='. $obj_row['pcash_id'] .'&pcrev='. $obj_row['pcash_rev'] .'" class="btn btn-warning edit_data" type="button" name="edit" title="แก้ไข / Edit">                                        <i class="icofont-edit"></i>                                    </a>                                    <button class="btn btn-primary view_data" type="button" name="view" id="'. $obj_row['pcash_id'] .'" title="ดู / View">                                        <i class="icofont-eye-alt"></i>                                    </button>                                                                    </div>                            </td>                        </tr>                        <tr class="d-none">                            <td colspan="2"></td>                            <td class="text-right">                                '. $total .'                            </td>                            <td colspan="2"></td>                        </tr>';            $i++;        }        // <button class="btn btn-danger delete_data" type="button" name="delete" id="'. $obj_row['pcash_no'] .'" title="ลบ / Delete">        //                              <i class="icofont-ui-delete"></i>        //                          </button>    } else {        $output .= '</tbody>                    <tbody>                        <tr width="100%">                            <td colspan="5" align="center">ไม่มีข้อมูลใบจ่ายเงินสดย่อย</td>                        </tr>                    </tbody>';    }    $total_links = ceil($total_data/$limit);    $previous_link = '';    $next_link = '';    $page_link = '';    $output .= '</table>                <div class="row mx-0 my-0">                    <div class="col-md-6 px-0 py-4">                        <ul class="pagination">';    $page_array = array();    if($total_links > 4) {        if($pageno < 5) {            for($count = 1; $count <= 5; $count++) {                $page_array[] = $count;            }            $page_array[] = '...';            $page_array[] = $total_links;        } else {            $end_limit = $total_links - 5;            if($pageno > $end_limit) {                $page_array[] = 1;                $page_array[] = '...';                for($count = $end_limit; $count <= $total_links; $count++) {                    $page_array[] = $count;                }            } else {                $page_array[] = 1;                $page_array[] = '...';                for($count = $pageno - 1; $count <= $pageno + 1; $count++) {                    $page_array[] = $count;                }                $page_array[] = '...';                $page_array[] = $total_links;            }        }    } else {        for($count = 1; $count <= $total_links; $count++) {            $page_array[] = $count;        }    }    for($count = 0; $count < count($page_array); $count++) {        if($pageno == $page_array[$count]) {            $page_link .= '<li class="page-item active">                            <a class="page-link" href="#"> '.$page_array[$count].' <span class="sr-only">(current)</span></a>                        </li> ';            $previous_id = $page_array[$count] - 1;            if($previous_id > 0) {                $previous_link = '<li class="page-item">                                    <a class="page-link" href="javascript:void(0)" data-page_number="'.$previous_id.'">                                        <i class="icofont-rounded-left"></i>                                    </a>                                </li>';            } else {                $previous_link = '<li class="page-item disabled">                                    <a class="page-link" href="#">                                        <i class="icofont-rounded-left"></i>                                    </a>                                </li>';            }            $next_id = $page_array[$count] + 1;            if($next_id > $total_links) {                $next_link = '<li class="page-item disabled">                                <a class="page-link" href="#">                                    <i class="icofont-rounded-right"></i>                                </a>                            </li>';            } else {                $next_link = '<li class="page-item">                                <a class="page-link" href="javascript:void(0)" data-page_number="'.$next_id.'">                                    <i class="icofont-rounded-right"></i>                                </a>                            </li>';            }        } else {            if($page_array[$count] == '...') {                $page_link .= '<li class="page-item disabled">                                <a class="page-link" href="#">...</a>                            </li> ';            } else {                $page_link .= '<li class="page-item">                                <a class="page-link" href="javascript:void(0)" data-page_number="'.$page_array[$count].'">'.$page_array[$count].'</a>                            </li>';            }        }    }    $output .= $previous_link . $page_link . $next_link;            $output .= '</ul>                    </div>                    <div class="col-md-6 px-0 py-4 text-right">                        <b>จำนวนใบจ่ายเงินสดย่อยทั้งหมด : </b>                        <span id="numINV">'.$total_data.'</span>                        <input class="form-control d-none" type="number" id="numINV" value="'.$total_data.'">                    </div>                </div>';    echo $output;?>